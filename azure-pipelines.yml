trigger:
  branches:
    include:
    - '*'
  tags:
    include:
    - '*'

variables:
  current_mysql_mode: STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
  legacy_mysql_mode: STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
  DOTNET_CLI_TELEMETRY_OPTOUT: 1

jobs:

- job: Nuget
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - task: UseDotNet@2
    displayName: Use .NET Core SDK
    inputs:
      packageType: sdk
      version: 3.0.100
      installationPath: $(Agent.ToolsDirectory)/dotnet
  - bash: |
      set -e

      final_version_kind=""
      echo "OfficialBuildId=$(Build.BuildNumber)"
      echo "DotNetFinalVersionKind=$final_version_kind"

      ./dotnet-env.sh dotnet pack \
        -c Release \
        "/p:OfficialBuildId=$(Build.BuildNumber)" \
        "/p:DotNetFinalVersionKind=$final_version_kind" \
        "/p:ContinuousIntegrationBuild=true" \
        src/EFCore.MySql/
    displayName: "Nuget Pack"
  - task: NuGetCommand@2
    displayName: "Nuget Push AZDO Feed"
    inputs:
      command: push
      nuGetFeedType: external
      publishFeedCredentials: PomeloEFCoreNuget
      packagesToPush: artifacts/**/*.nupkg
